[include mainsail.cfg]
[include macros.cfg]
[display_status]
[pause_resume]
[exclude_object]

########################################################
#        Gcode Arcs
########################################################
[gcode_arcs]
resolution: 1.0

########################################################
#        Virtual SD Card
########################################################
[virtual_sdcard]
path: /home/erikd/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

########################################################
#         MCU
########################################################
[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
baud: 115200
restart_method: command

########################################################
#      Printer
########################################################
[printer]
kinematics: cartesian
max_velocity: 100
max_accel: 5500
max_accel_to_decel: 5500
square_corner_velocity: 10.0
max_z_velocity: 10
max_z_accel: 1000

########################################################
#        MCU PI
########################################################
[mcu rpi]
serial: /tmp/klipper_host_mcu

########################################################
#        Steppers
########################################################
[stepper_x]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PC3
rotation_distance: 40
microsteps: 16
endstop_pin: PC4
position_min: -5
position_endstop: -5
position_max: 235
homing_speed: 80

[stepper_y]
step_pin: PB6
dir_pin: PB5
enable_pin: !PC3
rotation_distance: 40
microsteps: 16
endstop_pin: PC5
position_min: -2
position_endstop: -2
position_max: 235
homing_speed: 80

[stepper_z]
step_pin: PB4
dir_pin: !PB3
enable_pin: !PC3
rotation_distance: 8
microsteps: 16
endstop_pin: probe:z_virtual_endstop
position_min: -1.5
position_max: 255
homing_speed: 4
second_homing_speed: 1
homing_retract_dist: 2.0

########################################################
#         Extruders
########################################################
[extruder]
max_extrude_only_distance: 1000.0
step_pin: PC2
dir_pin: !PB9
enable_pin: !PC3
rotation_distance: 30.4768
microsteps: 16
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PB1
#control: pid
pressure_advance: 0.5
#pid_Kp: 14.32
#pid_Ki: 0.81
#pid_Kd: 63.12
min_temp: 0
max_temp: 265

########################################################
#       Heaters
########################################################
[heater_bed]
heater_pin: PA2
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PB0
control: pid
pid_Kp: 79.49
pid_Ki: 1.17
pid_Kd: 1349.52
min_temp: 0
max_temp: 120

########################################################
#       Fans
########################################################
[fan]
pin: PA0
kick_start_time: 0.5

[heater_fan my_nozzle_fan]
pin: PD2
max_power: 1.0
shutdown_speed : 0
heater:extruder
heater_temp : 60
fan_speed : 1.0

########################################################
#       Probe
########################################################
[probe]
pin: PA4
x_offset: 0.0
y_offset: 0.0
#z_offset: -0.2
speed: 3
lift_speed: 3
samples_tolerance: 0.065
samples_tolerance_retries: 3
samples: 5

########################################################
#        Bed mesh
########################################################
[bed_mesh]
speed: 50
horizontal_move_z: 5
mesh_min: 5,5
mesh_max: 230,230
probe_count: 10,10
fade_start: 1
fade_end: 20
fade_target: 0
algorithm: bicubic
split_delta_z: .025
move_check_distance: 5

########################################################
#        Sensors
########################################################
[filament_switch_sensor filament_sensor]
pause_on_runout: true
switch_pin: ^!PA7

[temperature_sensor enclosure_temperature]
sensor_type: DS18B20
sensor_mcu: rpi
serial_no: 28-3c01f0968e0a
ds18_report_time: 3
gcode_id: C
min_temp: 0
max_temp: 120

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################################
#      Printer specific pins
########################################################
[output_pin LED_pin]
pin: PA6

########################################################
#      idle timeout
########################################################
[idle_timeout]
timeout: 1200

########################################################
#         Safe z Home
########################################################
[safe_z_home]
home_xy_position: 117.5,117.5
z_hop: 20
z_hop_speed: 5

########################################################
#         Input Shaper
########################################################
[input_shaper]
shaper_freq_x: 44.944
shaper_freq_y: 40.816
shaper_type: ei

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.278333, -0.249167, -0.278333, -0.442500, -0.633333, -0.712500
#*# 	-0.050833, -0.015833, -0.050833, -0.195833, -0.365833, -0.510833
#*# 	-0.097500, -0.063333, -0.050833, -0.160000, -0.311667, -0.509167
#*# 	-0.140000, -0.070833, -0.077500, -0.187500, -0.434167, -0.602500
#*# 	-0.134167, -0.062500, -0.083333, -0.187500, -0.402500, -0.561667
#*# 	-0.277500, -0.196667, -0.205000, -0.365000, -0.547500, -0.668333
#*# tension = 0.2
#*# min_x = 5.0
#*# algo = lagrange
#*# y_count = 6
#*# mesh_y_pps = 2
#*# min_y = 5.0
#*# x_count = 6
#*# max_y = 230.0
#*# mesh_x_pps = 2
#*# max_x = 230.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.682
#*# pid_ki = 1.032
#*# pid_kd = 113.829
#*#
#*# [probe]
#*# z_offset = -0.179
#*#
#*# [bed_mesh default_23]
#*# version = 1
#*# points =
#*# 	  -0.126667, -0.072500, -0.089167, -0.082500, -0.102500, -0.129167, -0.182500, -0.168333, -0.146667, -0.170833, -0.213333, -0.251667, -0.296667, -0.325833, -0.330833, -0.346667, -0.390833, -0.467500, -0.697500, -0.691667, -0.621667, -0.593333, -0.615833
#*# 	  -0.100000, -0.032500, -0.063333, -0.034167, -0.072500, -0.087500, -0.145000, -0.131667, -0.098333, -0.115833, -0.143333, -0.186667, -0.230833, -0.260000, -0.268333, -0.278333, -0.330000, -0.405833, -0.458333, -0.503333, -0.533333, -0.542500, -0.561667
#*# 	  -0.070833, -0.016667, -0.004167, 0.009167, -0.022500, -0.047500, -0.089167, -0.060000, -0.031667, -0.050833, -0.080833, -0.125000, -0.172500, -0.204167, -0.199167, -0.215000, -0.260000, -0.327500, -0.380833, -0.444167, -0.478333, -0.473333, -0.482500
#*# 	  -0.051667, -0.005000, 0.024167, 0.040833, 0.019167, 0.004167, -0.042500, -0.024167, 0.003333, -0.010833, -0.028333, -0.075000, -0.110833, -0.128333, -0.157500, -0.170000, -0.207500, -0.266667, -0.336667, -0.391667, -0.420000, -0.415833, -0.438333
#*# 	  0.024167, 0.050000, 0.063333, 0.089167, 0.075000, 0.049167, 0.010833, 0.027500, 0.050833, 0.042500, 0.029167, -0.025000, -0.059167, -0.108333, -0.105833, -0.113333, -0.143333, -0.218333, -0.280833, -0.340000, -0.367500, -0.370000, -0.387500
#*# 	  0.065833, 0.074167, 0.163333, 0.158333, 0.108333, 0.085000, 0.045000, 0.064167, 0.092500, 0.084167, 0.066667, -0.004167, -0.052500, -0.069167, -0.069167, -0.091667, -0.136667, -0.197500, -0.251667, -0.330000, -0.355833, -0.359167, -0.379167
#*# 	  0.085000, 0.180833, 0.102500, 0.131667, 0.112500, 0.096667, 0.058333, 0.059167, 0.118333, 0.090833, 0.056667, 0.010833, -0.051667, -0.052500, -0.056667, -0.076667, -0.111667, -0.183333, -0.243333, -0.317500, -0.344167, -0.351667, -0.360833
#*# 	  0.051667, 0.110833, 0.081667, 0.117500, 0.085000, 0.086667, 0.058333, 0.103333, 0.114167, 0.085833, 0.049167, -0.001667, -0.014167, -0.080000, -0.070833, -0.076667, -0.109167, -0.185833, -0.245833, -0.316667, -0.330833, -0.354167, -0.373333
#*# 	  -0.021667, 0.039167, 0.076667, 0.098333, 0.068333, 0.064167, 0.018333, 0.054167, 0.084167, 0.058333, 0.040000, -0.004167, -0.035000, -0.087500, -0.082500, -0.095833, -0.129167, -0.194167, -0.235833, -0.318333, -0.340833, -0.363333, -0.375000
#*# 	  0.016667, 0.074167, 0.009167, 0.048333, 0.056667, 0.051667, -0.012500, 0.035833, 0.044167, 0.026667, 0.003333, -0.024167, -0.081667, -0.100833, -0.102500, -0.113333, -0.160000, -0.202500, -0.293333, -0.350833, -0.351667, -0.391667, -0.400000
#*# 	  -0.008333, 0.019167, 0.018333, 0.075000, 0.028333, -0.004167, -0.031667, 0.004167, 0.015833, 0.014167, -0.020833, -0.055000, -0.080833, -0.090000, -0.118333, -0.130833, -0.175833, -0.215000, -0.300000, -0.357500, -0.396667, -0.393333, -0.416667
#*# 	  -0.046667, -0.026667, 0.004167, 0.022500, 0.014167, -0.008333, -0.007500, 0.011667, 0.008333, 0.004167, -0.014167, -0.080833, -0.084167, -0.115000, -0.102500, -0.138333, -0.196667, -0.250000, -0.335833, -0.387500, -0.390833, -0.433333, -0.455833
#*# 	  -0.007500, -0.024167, 0.015833, 0.043333, 0.012500, -0.001667, -0.035000, 0.005833, 0.014167, 0.005000, -0.019167, -0.053333, -0.110000, -0.121667, -0.133333, -0.150833, -0.195000, -0.244167, -0.316667, -0.387500, -0.432500, -0.441667, -0.461667
#*# 	  0.013333, -0.038333, -0.005833, 0.019167, 0.014167, 0.000833, -0.014167, 0.007500, 0.029167, -0.014167, -0.033333, -0.051667, -0.112500, -0.130000, -0.125833, -0.165833, -0.201667, -0.260833, -0.295000, -0.407500, -0.436667, -0.449167, -0.473333
#*# 	  -0.070833, 0.016667, -0.011667, 0.026667, 0.016667, -0.020000, -0.026667, 0.015000, 0.015000, -0.005000, -0.030000, -0.060833, -0.107500, -0.139167, -0.129167, -0.150833, -0.200833, -0.257500, -0.336667, -0.411667, -0.451667, -0.438333, -0.465833
#*# 	  -0.032500, -0.030833, -0.010000, 0.022500, 0.008333, 0.017500, -0.006667, 0.020000, -0.002500, -0.011667, -0.030000, -0.069167, -0.102500, -0.133333, -0.135833, -0.161667, -0.195000, -0.261667, -0.336667, -0.400833, -0.420000, -0.427500, -0.440000
#*# 	  -0.031667, -0.015833, 0.000000, 0.027500, 0.016667, 0.005833, -0.055833, 0.005000, 0.023333, 0.005000, -0.010000, -0.053333, -0.125833, -0.124167, -0.130833, -0.159167, -0.190833, -0.245833, -0.315000, -0.375833, -0.385833, -0.412500, -0.419167
#*# 	  -0.061667, -0.011667, 0.030833, 0.081667, 0.035833, -0.008333, -0.047500, -0.015000, 0.016667, 0.021667, -0.005000, -0.057500, -0.098333, -0.101667, -0.114167, -0.158333, -0.190833, -0.242500, -0.296667, -0.391667, -0.399167, -0.415000, -0.413333
#*# 	  -0.020833, -0.005000, 0.029167, 0.049167, 0.034167, 0.007500, -0.030000, 0.002500, 0.020000, 0.005833, -0.019167, -0.060000, -0.080833, -0.097500, -0.104167, -0.151667, -0.194167, -0.257500, -0.320000, -0.387500, -0.421667, -0.431667, -0.426667
#*# 	  -0.043333, -0.017500, 0.012500, 0.028333, 0.014167, -0.015833, -0.063333, -0.036667, -0.007500, -0.008333, -0.033333, -0.087500, -0.127500, -0.157500, -0.171667, -0.184167, -0.225000, -0.283333, -0.335000, -0.399167, -0.439167, -0.430833, -0.438333
#*# 	  -0.099167, -0.050833, -0.022500, 0.008333, -0.021667, -0.046667, -0.075000, -0.065833, -0.029167, -0.045833, -0.070000, -0.112500, -0.170833, -0.191667, -0.195000, -0.218333, -0.245833, -0.303333, -0.364167, -0.447500, -0.460000, -0.450833, -0.460833
#*# 	  -0.151667, -0.093333, -0.054167, -0.042500, -0.073333, -0.100000, -0.129167, -0.096667, -0.068333, -0.073333, -0.110833, -0.143333, -0.204167, -0.239167, -0.240833, -0.250833, -0.283333, -0.352500, -0.420833, -0.484167, -0.495833, -0.494167, -0.487500
#*# 	  -0.181667, -0.128333, -0.100000, -0.079167, -0.092500, -0.113333, -0.160000, -0.142500, -0.104167, -0.115833, -0.144167, -0.185000, -0.235000, -0.279167, -0.267500, -0.278333, -0.318333, -0.377500, -0.440000, -0.510000, -0.535833, -0.526667, -0.515833
#*# x_count = 23
#*# y_count = 23
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 5.0
#*# max_x = 229.84
#*# min_y = 5.0
#*# max_y = 229.84
